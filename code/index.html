<!DOCTYPE html>
<html>
  <head>
    <title>Accidentologie Paris</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/3.15/themes/css/cartodb.css" />
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
	<link rel="stylesheet" href="/resources/demos/style.css">
	<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	<script>
	$( function() {
		$( "input" ).checkboxradio({
	  		icon: false
		});
	} );
	</script>
  </head>
  <body>
  	<div style="margin:auto; width:80%; height:220px;">
	  	<h3 style="text-align:center;">Choix multiple par Années/Mois/Jours</h3>
		<div class="widget" style="float:left; width:100px; height:80%;">
			<fieldset>
				<legend>Années : </legend>
				<label for="checkbox-2012">2012</label>
				<input type="checkbox" name="checkbox-2012" id="checkbox-2012">
				<label for="checkbox-2013">2013</label>
				<input type="checkbox" name="checkbox-2013" id="checkbox-2013">
			</fieldset>
		</div>
		<div class="widget" style="float:left; margin-left:200px; margin-right:50px; width:450px; height:80%;">
			<fieldset>
				<legend>Mois : </legend>
				<label for="checkbox-Janvier">Janvier</label>
				<input type="checkbox" name="checkbox-1" id="checkbox-Janvier">
				<label for="checkbox-Fevrier">Février</label>
				<input type="checkbox" name="checkbox-Fevrier" id="checkbox-Fevrier">
				<label for="checkbox-Mars">Mars</label>
				<input type="checkbox" name="checkbox-Mars" id="checkbox-Mars">
				<label for="checkbox-Avril">Avril</label>
				<input type="checkbox" name="checkbox-Avril" id="checkbox-Avril">
				<label for="checkbox-Mai">Mai</label>
				<input type="checkbox" name="checkbox-Mai" id="checkbox-Mai">
				<label for="checkbox-Juin">Juin</label>
				<input type="checkbox" name="checkbox-Juin" id="checkbox-Juin">
				<label for="checkbox-Juillet">Juillet</label>
				<input type="checkbox" name="checkbox-Juillet" id="checkbox-Juillet">
				<label for="checkbox-Aout">Août</label>
				<input type="checkbox" name="checkbox-Aout" id="checkbox-Aout">
				<label for="checkbox-Septembre">Septembre</label>
				<input type="checkbox" name="checkbox-Septembre" id="checkbox-Septembre">
				<label for="checkbox-Octobre">Octobre</label>
				<input type="checkbox" name="checkbox-Octobre" id="checkbox-Octobre">
				<label for="checkbox-Novembre">Novembre</label>
				<input type="checkbox" name="checkbox-Novembre" id="checkbox-Novembre">
				<label for="checkbox-Decembre">Décembre</label>
				<input type="checkbox" name="checkbox-Decembre" id="checkbox-Decembre">
			</fieldset>
		</div>
		<div class="widget" style="float:right; width:500px; height:80%;">
			<fieldset>
				<legend>Jours : </legend>
				<label for="checkbox-01">01</label>
				<input type="checkbox" name="checkbox-01" id="checkbox-01">
				<label for="checkbox-02">02</label>
				<input type="checkbox" name="checkbox-02" id="checkbox-02">
				<label for="checkbox-03">03</label>
				<input type="checkbox" name="checkbox-03" id="checkbox-03">
				<label for="checkbox-04">04</label>
				<input type="checkbox" name="checkbox-04" id="checkbox-04">
				<label for="checkbox-05">05</label>
				<input type="checkbox" name="checkbox-05" id="checkbox-05">
				<label for="checkbox-06">06</label>
				<input type="checkbox" name="checkbox-06" id="checkbox-06">
				<label for="checkbox-07">07</label>
				<input type="checkbox" name="checkbox-07" id="checkbox-07">
				<label for="checkbox-08">08</label>
				<input type="checkbox" name="checkbox-08" id="checkbox-08">
				<label for="checkbox-09">09</label>
				<input type="checkbox" name="checkbox-09" id="checkbox-09">
				<label for="checkbox-10">10</label>
				<input type="checkbox" name="checkbox-10" id="checkbox-10">
				<label for="checkbox-11">11</label>
				<input type="checkbox" name="checkbox-11" id="checkbox-11">
				<label for="checkbox-12">12</label>
				<input type="checkbox" name="checkbox-12" id="checkbox-12">
				<label for="checkbox-13">13</label>
				<input type="checkbox" name="checkbox-13" id="checkbox-13">
				<label for="checkbox-14">14</label>
				<input type="checkbox" name="checkbox-14" id="checkbox-14">
				<label for="checkbox-15">15</label>
				<input type="checkbox" name="checkbox-15" id="checkbox-15">
				<label for="checkbox-16">16</label>
				<input type="checkbox" name="checkbox-16" id="checkbox-16">
				<label for="checkbox-17">17</label>
				<input type="checkbox" name="checkbox-17" id="checkbox-17">
				<label for="checkbox-18">18</label>
				<input type="checkbox" name="checkbox-18" id="checkbox-18">
				<label for="checkbox-19">19</label>
				<input type="checkbox" name="checkbox-19" id="checkbox-19">
				<label for="checkbox-20">20</label>
				<input type="checkbox" name="checkbox-20" id="checkbox-20">
				<label for="checkbox-21">21</label>
				<input type="checkbox" name="checkbox-21" id="checkbox-21">
				<label for="checkbox-22">22</label>
				<input type="checkbox" name="checkbox-22" id="checkbox-22">
				<label for="checkbox-23">23</label>
				<input type="checkbox" name="checkbox-23" id="checkbox-23">
				<label for="checkbox-24">24</label>
				<input type="checkbox" name="checkbox-24" id="checkbox-24">
				<label for="checkbox-25">25</label>
				<input type="checkbox" name="checkbox-25" id="checkbox-25">
				<label for="checkbox-26">26</label>
				<input type="checkbox" name="checkbox-26" id="checkbox-26">
				<label for="checkbox-27">27</label>
				<input type="checkbox" name="checkbox-27" id="checkbox-27">
				<label for="checkbox-28">28</label>
				<input type="checkbox" name="checkbox-28" id="checkbox-28">
				<label for="checkbox-29">29</label>
				<input type="checkbox" name="checkbox-29" id="checkbox-29">
				<label for="checkbox-30">30</label>
				<input type="checkbox" name="checkbox-30" id="checkbox-30">
				<label for="checkbox-31">31</label>
				<input type="checkbox" name="checkbox-31" id="checkbox-31">
			</fieldset>
		</div>
	</div>
	
	<div class="widget" style="margin:auto; height:210px;">
		<h3 style="text-align:center;">Choix multiple des arrondissements</h3>
		<fieldset style="margin:auto; width:25%;">
			<legend>Arrondissements : </legend>
			<label for="checkbox-A01">01</label>
			<input type="checkbox" name="checkbox-A01" id="checkbox-A01">
			<label for="checkbox-A02">02</label>
			<input type="checkbox" name="checkbox-A02" id="checkbox-A02">
			<label for="checkbox-A03">03</label>
			<input type="checkbox" name="checkbox-A03" id="checkbox-A03">
			<label for="checkbox-A04">04</label>
			<input type="checkbox" name="checkbox-A04" id="checkbox-A04">
			<label for="checkbox-A05">05</label>
			<input type="checkbox" name="checkbox-A05" id="checkbox-A05">
			<label for="checkbox-A06">06</label>
			<input type="checkbox" name="checkbox-A06" id="checkbox-A06">
			<label for="checkbox-A07">07</label>
			<input type="checkbox" name="checkbox-A07" id="checkbox-A07">
			<label for="checkbox-A08">08</label>
			<input type="checkbox" name="checkbox-A08" id="checkbox-A08">
			<label for="checkbox-A09">09</label>
			<input type="checkbox" name="checkbox-A09" id="checkbox-A09">
			<label for="checkbox-A10">10</label>
			<input type="checkbox" name="checkbox-A10" id="checkbox-A10">
			<label for="checkbox-A11">11</label>
			<input type="checkbox" name="checkbox-A11" id="checkbox-A11">
			<label for="checkbox-A12">12</label>
			<input type="checkbox" name="checkbox-A12" id="checkbox-A12">
			<label for="checkbox-A13">13</label>
			<input type="checkbox" name="checkbox-A13" id="checkbox-A13">
			<label for="checkbox-A14">14</label>
			<input type="checkbox" name="checkbox-A14" id="checkbox-A14">
			<label for="checkbox-A15">15</label>
			<input type="checkbox" name="checkbox-A15" id="checkbox-A15">
			<label for="checkbox-A16">16</label>
			<input type="checkbox" name="checkbox-A16" id="checkbox-A16">
			<label for="checkbox-A17">17</label>
			<input type="checkbox" name="checkbox-A17" id="checkbox-A17">
			<label for="checkbox-A18">18</label>
			<input type="checkbox" name="checkbox-A18" id="checkbox-A18">
			<label for="checkbox-A19">19</label>
			<input type="checkbox" name="checkbox-A19" id="checkbox-A19">
			<label for="checkbox-A20">20</label>
			<input type="checkbox" name="checkbox-A20" id="checkbox-A20">
		</fieldset>
	</div>
	
	<div id="overlay" style="margin:auto; height:80px;">
		<h3 style="text-align:center;">Choix par un intervalle de date</h3>
		<form style="text-align:center;">
		Date de début: <input type="date" id="beginDate" name="beginDate" value="2012-01-01" min="2012-01-01" max="2013-12-31"><br>
		Date de fin: <input type="date" id="endDate" name="endDate" value="2012-01-01" min= "2012-01-01" max="2013-12-31">
		</form>
    </div>
    
    <div id="overlay2" style="margin:auto; height:100px;">
		<h3 style="text-align:center;">Choix d'un intervalle d'heure</h3>
		<form style="text-align:center;">
		Heure de début: <input type="time" id="beginHour" name="beginHour" value="09:00">
		<br />
		Heure de fin: <input type="time" id="endHour" name="endHour" value="12:00">
		</form>
	</div>
  	<br />
	<div id="map"></div>

   <!-- include cartodb.js library -->
    <script src="http://libs.cartocdn.com/cartodb.js/v3/3.15/cartodb.js"></script>
	<script src="https://d3js.org/d3.v4.min.js"></script>
    <script>
		
    //  function main() 
     		  
		var bigmapheight = 650;
	  	var smallmapheight = 300;
	  	var mapbreakwidth = 720;
	  	var highzoom = 11;
	  	var lowzoom = 7;
	  	var initzoom;
//		var vizjson = 'https://mediafin.cartodb.com/api/v2/viz/6a800846-5607-11e5-b2d0-0e4fddd5de28/viz.json';
		
		//Set initial mapheight, based on the calculated width of the map container
		if ($("#map").width() > mapbreakwidth) {
			initzoom = highzoom;
			$("#map").height(bigmapheight);
		}
		else {
			initzoom = lowzoom;
			$("#map").height(smallmapheight);
		};
		
        var map = new L.Map('map', {
          center: [48.85841, 2.3488],
          zoom: initzoom
        });
		  
        L.tileLayer('http://tile.stamen.com/toner/{z}/{x}/{y}.png', {
          attribution: 'Stamen'
        }).addTo(map);
		  
        cartodb.createLayer(map, vizjson)
            .addTo(map)
         .on('done', function(layer) {
           layer.setInteraction(true);
		  
          layer.on('error', function(err) {
            cartodb.log.log('error: ' + err);
          });	
        })
		.on('error', function() {
          cartodb.log.log("some error occurred");
        });
		  
		//Use Leaflets resize event to set new map height and zoom level
		map.on('resize', function(e) {
		  	if (e.newSize.x < mapbreakwidth) {
				map.setZoom(lowzoom);
				$("#map").css('height', smallmapheight);
			};
			  
			if (e.newSize.x > mapbreakwidth) {
				map.setZoom(highzoom);
				$("#map").css('height', bigmapheight);
				$("#map").css('height', bigmapheight);
			};
		  });
    
      	// you could use $(window).load(main);
    	//  window.onload = main;
    	
    
    
    	///*******************************************///
		///********** Partie accidentologie **********///
		///*******************************************///
        
        // Convertie un intervalle d'heure en un intervalle de minute
     	function getMinutesInterval(hoursInterval) {
			minutesInterval = [];
			minutesInterval[0] = (parseInt(hoursInterval[0].slice(0,2)) * 60) + parseInt(hoursInterval[0].slice(3,5));
			minutesInterval[1] = (parseInt(hoursInterval[1].slice(0,2)) * 60) + parseInt(hoursInterval[1].slice(3,5));
			return minutesInterval;
		}


		// Renvoie si oui ou non une heure est incluse dans un intervalle d'heure
		function checkHoursInterval(hour, interval) {
			h = (parseInt(hour.slice(0,2)) * 60) + (parseInt(hour.slice(3,5)));
			if(h >= interval[0] && h <= interval[1]) {
				return true;
			}
			return false;
		}
		
		
		// Convertie un intervalle de date en un intervalle d'heure
		function getDaysInterval(dateInterval) {
			daysInterval = [];
			daysInterval[0] = (parseInt(dateInterval[0].slice(0,4)) * 365.2425) + (parseInt(dateInterval[0].slice(5,7)) * 30.44) + parseInt(dateInterval[0].slice(8,10));
			daysInterval[1] = (parseInt(dateInterval[1].slice(0,4)) * 365.2425) + (parseInt(dateInterval[1].slice(5,7)) * 30.44) + parseInt(dateInterval[1].slice(8,10));
			return daysInterval;
		}


		// Renvoie si oui ou non une date est incluse dans un intervalle de date
		function checkDaysInterval(date, interval) {
			d = (parseInt(date.slice(0,4)) * 365.2425) + (parseInt(date.slice(5,7)) * 30.44) + parseInt(date.slice(8,10));
			if(d >= interval[0] && d <= interval[1]) {
				return true;
			}
			return false;
		}
		
        
		 // Affecte un accident a une zone
		 function affectZone(accident, rayon) {
		 	for(var i=0; i < zones.length; ++i) {
		 		center = zones[i].center;
		 		x = accident.properties.wgs[0];
		 		y = accident.properties.wgs[1];
			 	// check coordonnee en X et Y
			 	if(x <= center[0]+rayon && x >= center[0]-rayon && y <= center[1]+rayon && y >= center[1]-rayon) {
		 			liste_accidents.push({ "zone": i, "accident": accident });
		 			return 0;
			 	}
			}
		
			// Aucune zone ne convient, on en creer donc une nouvelle
			zones.push({ "center": accident.properties.wgs, "stats" : { "nbAcc": 0, "Indem": 0, "BL": 0, "BH": 0, "Fuite": 0, "Conducteur": 0, "Passage": 0, "Pieton": 0, "Velo": 0, "Scooter": 0, "Moto": 0, "Voiture": 0, "VehiculeUtilitaire": 0, "BusCar": 0, "PoidsLourd": 0, "Tram": 0  } });
			id = zones.length-1;
			liste_accidents.push({ "zone": id, "accident": accident });
		 }
		 
		 
		 // Recupere toutes les zones d'accident
		 function getZones(accidents, rayon, arrondissements, annees, mois, jours, hoursInterval, dateInterval) {
		 	// On convertit l'intervalle d'heure en minute
		 	minutesInterval = []
		 	if(hoursInterval.length != 0) {
		 		minutesInterval = getMinutesInterval(hoursInterval);
		 	}
		 	
		 	// On convertit l'intervalle de date en jours
		 	daysInterval = []
		 	if(dateInterval.length != 0) {
		 		daysInterval = getDaysInterval(dateInterval);
		 	}
		 	
		 	// Creation des zones d'accident
		 	for(var i = 0; i < accidents.length; ++i) {
		 		// Filtre par arrondissement
		 		if(arrondissements.length == 0 || arrondissements.indexOf(accidents[i].properties.cp) != -1) {
		 			// Filtre par un intervalle de date (priorite) ou annees - mois - jours en particulier
		 			if(daysInterval.length != 0) {
		 				// Filtre par un intervalle de date
		 				if(checkDaysInterval(accidents[i].properties.date, daysInterval)) {
			 				// Filtre par un intervalle d'heure
			 				if(minutesInterval.length == 0 || checkHoursInterval(accidents[i].properties.heure, minutesInterval)) {
			 					id = affectZone(accidents[i], rayon);
			 				}
		 				}
		 			} else {	// Filtre par annees - mois - jours en particulier
			 			// Filtre par annee
			 			if(annees.length == 0 || annees.indexOf(accidents[i].properties.date.slice(0,4)) != -1) {
			 				// Filtre par mois
			 				if(mois.length == 0 || mois.indexOf(accidents[i].properties.date.slice(5,7)) != -1) {
			 					// Filtre par jours
			 					if(jours.length == 0 || jours.indexOf(accidents[i].properties.date.slice(8,10)) != -1) {
			 						// Filtre par un intervalle d'heure
			 						if(minutesInterval.length == 0 || checkHoursInterval(accidents[i].properties.heure, minutesInterval)) {
		 								id = affectZone(accidents[i], rayon);
		 							}
			 					}
			 				}
		 				}
	 				}
	 			}
		 	}
		 	
		 	
		 	// Ajout des statistiques aux zones
		 	for(var i = 0; i < liste_accidents.length; ++i) {
		 		// Mise a jour du nombre d'accident par zone
		 		zones[liste_accidents[i].zone].stats.nbAcc++;
		 		
		 		// Mise a jour de la gravite des blessures lors des accidents d'une zone (Indem, BL, BH)
		 		accident = liste_accidents[i].accident.properties;
		 		if(accident.usager_1_grav == "Indem") { zones[liste_accidents[i].zone].stats.Indem++; }
		 		if(accident.usager_1_grav == "BL") { zones[liste_accidents[i].zone].stats.BL++; }
		 		if(accident.usager_1_grav == "BH") { zones[liste_accidents[i].zone].stats.BH++; }
		 		if(accident.usager_2_grav == "Indem") { zones[liste_accidents[i].zone].stats.Indem++; }
		 		if(accident.usager_2_grav == "BL") { zones[liste_accidents[i].zone].stats.BL++; }
		 		if(accident.usager_2_grav == "BH") { zones[liste_accidents[i].zone].stats.BH++; }
		 		if(accident.usager_3_grav == "Indem") { zones[liste_accidents[i].zone].stats.Indem++; }
		 		if(accident.usager_3_grav == "BL") { zones[liste_accidents[i].zone].stats.BL++; }
		 		if(accident.usager_3_grav == "BH") { zones[liste_accidents[i].zone].stats.BH++; }
		 		if(accident.usager_4_grav == "Indem") { zones[liste_accidents[i].zone].stats.Indem++; }
		 		if(accident.usager_4_grav == "BL") { zones[liste_accidents[i].zone].stats.BL++; }
		 		if(accident.usager_4_grav == "BH") { zones[liste_accidents[i].zone].stats.BH++; }
		 		
		 		// Nombre de vehicule en fuite
		 		if(accident.usager_1_lveh == "Z") { zones[liste_accidents[i].zone].stats.Fuite++; }
		 		if(accident.usager_2_lveh == "Z") { zones[liste_accidents[i].zone].stats.Fuite++; }
		 		if(accident.usager_3_lveh == "Z") { zones[liste_accidents[i].zone].stats.Fuite++; }
		 		
		 		// Type d'usage (Conducteur, Passage, Pieton)
		 		if(accident.usager_1_catu == "Cond") { zones[liste_accidents[i].zone].stats.Conducteur++; }
		 		if(accident.usager_1_catu == "Pass") { zones[liste_accidents[i].zone].stats.Passage++; }
		 		if(accident.usager_1_catu == "Piéton") { zones[liste_accidents[i].zone].stats.Pieton++; }
		 		if(accident.usager_2_catu == "Cond") { zones[liste_accidents[i].zone].stats.Conducteur++; }
		 		if(accident.usager_2_catu == "Pass") { zones[liste_accidents[i].zone].stats.Passage++; }
		 		if(accident.usager_2_catu == "Piéton") { zones[liste_accidents[i].zone].stats.Pieton++; }
		 		if(accident.usager_3_catu == "Cond") { zones[liste_accidents[i].zone].stats.Conducteur++; }	
		 		if(accident.usager_3_catu == "Pass") { zones[liste_accidents[i].zone].stats.Passage++; }
		 		if(accident.usager_3_catu == "Piéton") { zones[liste_accidents[i].zone].stats.Pieton++; }
		 		if(accident.usager_4_catu == "Cond") { zones[liste_accidents[i].zone].stats.Conducteur++; }	
		 		if(accident.usager_4_catu == "Pass") { zones[liste_accidents[i].zone].stats.Passage++; }
		 		if(accident.usager_4_catu == "Piéton") { zones[liste_accidents[i].zone].stats.Pieton++; } 		
		 		
		 		// Type de vehicule (Velo, Scooter, Moto, Voiture, VehiculeUtilitaire, BusCar, PoidsLourd, Tram)
		 		if(accident.vehicule_1_cadmin == "Bicy") { zones[liste_accidents[i].zone].stats.Velo++; }
		 		if(accident.vehicule_1_cadmin == "Cyclo") { zones[liste_accidents[i].zone].stats.Scooter++; }
		 		if(accident.vehicule_1_cadmin == "Scoo<=50") { zones[liste_accidents[i].zone].stats.Scooter++; }
		 		if(accident.vehicule_1_cadmin == "Scoo50-125") { zones[liste_accidents[i].zone].stats.Scooter++; }
		 		if(accident.vehicule_1_cadmin == "Scoo>125") { zones[liste_accidents[i].zone].stats.Scooter++; }
		 		if(accident.vehicule_1_cadmin == "Moto50-125") { zones[liste_accidents[i].zone].stats.Moto++; }
		 		if(accident.vehicule_1_cadmin == "Moto>125") { zones[liste_accidents[i].zone].stats.Moto++; }
		 		if(accident.vehicule_1_cadmin == "VL") { zones[liste_accidents[i].zone].stats.Voiture++; }
		 		if(accident.vehicule_1_cadmin == "Voi") { zones[liste_accidents[i].zone].stats.Voiture++; }
		 		if(accident.vehicule_1_cadmin == "VU") { zones[liste_accidents[i].zone].stats.VehiculeUtilitaire++; }
		 		if(accident.vehicule_1_cadmin == "BUS") { zones[liste_accidents[i].zone].stats.BusCar++; }
		 		if(accident.vehicule_1_cadmin == "Car") { zones[liste_accidents[i].zone].stats.BusCar++; }
		 		if(accident.vehicule_1_cadmin == "PL<=7,5") { zones[liste_accidents[i].zone].stats.PoidsLourd++; }
		 		if(accident.vehicule_1_cadmin == "PL>7,5") { zones[liste_accidents[i].zone].stats.PoidsLourd++; }
		 		if(accident.vehicule_1_cadmin == "PLRem") { zones[liste_accidents[i].zone].stats.PoidsLourd++; }
		 		if(accident.vehicule_1_cadmin == "TRSem") { zones[liste_accidents[i].zone].stats.PoidsLourd++; }
		 		if(accident.vehicule_1_cadmin == "Tram") { zones[liste_accidents[i].zone].stats.Tram++; }
		 		
		 		if(accident.vehicule_2_cadmin == "Bicy") { zones[liste_accidents[i].zone].stats.Velo++; }
		 		if(accident.vehicule_2_cadmin == "Cyclo") { zones[liste_accidents[i].zone].stats.Scooter++; }
		 		if(accident.vehicule_2_cadmin == "Scoo<=50") { zones[liste_accidents[i].zone].stats.Scooter++; }
		 		if(accident.vehicule_2_cadmin == "Scoo50-125") { zones[liste_accidents[i].zone].stats.Scooter++; }
		 		if(accident.vehicule_2_cadmin == "Scoo>125") { zones[liste_accidents[i].zone].stats.Scooter++; }
		 		if(accident.vehicule_2_cadmin == "Moto50-125") { zones[liste_accidents[i].zone].stats.Moto++; }
		 		if(accident.vehicule_2_cadmin == "Moto>125") { zones[liste_accidents[i].zone].stats.Moto++; }
		 		if(accident.vehicule_2_cadmin == "VL") { zones[liste_accidents[i].zone].stats.Voiture++; }
		 		if(accident.vehicule_2_cadmin == "Voi") { zones[liste_accidents[i].zone].stats.Voiture++; }
		 		if(accident.vehicule_2_cadmin == "VU") { zones[liste_accidents[i].zone].stats.VehiculeUtilitaire++; }
		 		if(accident.vehicule_2_cadmin == "BUS") { zones[liste_accidents[i].zone].stats.BusCar++; }
		 		if(accident.vehicule_2_cadmin == "Car") { zones[liste_accidents[i].zone].stats.BusCar++; }
		 		if(accident.vehicule_2_cadmin == "PL<=7,5") { zones[liste_accidents[i].zone].stats.PoidsLourd++; }
		 		if(accident.vehicule_2_cadmin == "PL>7,5") { zones[liste_accidents[i].zone].stats.PoidsLourd++; }
		 		if(accident.vehicule_2_cadmin == "PLRem") { zones[liste_accidents[i].zone].stats.PoidsLourd++; }
		 		if(accident.vehicule_2_cadmin == "TRSem") { zones[liste_accidents[i].zone].stats.PoidsLourd++; }
		 		if(accident.vehicule_2_cadmin == "Tram") { zones[liste_accidents[i].zone].stats.Tram++; }
		 		
		 		if(accident.vehicule_3_cadmin == "Bicy") { zones[liste_accidents[i].zone].stats.Velo++; }
		 		if(accident.vehicule_3_cadmin == "Cyclo") { zones[liste_accidents[i].zone].stats.Scooter++; }
		 		if(accident.vehicule_3_cadmin == "Scoo<=50") { zones[liste_accidents[i].zone].stats.Scooter++; }
		 		if(accident.vehicule_3_cadmin == "Scoo50-125") { zones[liste_accidents[i].zone].stats.Scooter++; }
		 		if(accident.vehicule_3_cadmin == "Scoo>125") { zones[liste_accidents[i].zone].stats.Scooter++; }
		 		if(accident.vehicule_3_cadmin == "Moto50-125") { zones[liste_accidents[i].zone].stats.Moto++; }
		 		if(accident.vehicule_3_cadmin == "Moto>125") { zones[liste_accidents[i].zone].stats.Moto++; }
		 		if(accident.vehicule_3_cadmin == "VL") { zones[liste_accidents[i].zone].stats.Voiture++; }
		 		if(accident.vehicule_3_cadmin == "Voi") { zones[liste_accidents[i].zone].stats.Voiture++; }
		 		if(accident.vehicule_3_cadmin == "VU") { zones[liste_accidents[i].zone].stats.VehiculeUtilitaire++; }
		 		if(accident.vehicule_3_cadmin == "BUS") { zones[liste_accidents[i].zone].stats.BusCar++; }
		 		if(accident.vehicule_3_cadmin == "Car") { zones[liste_accidents[i].zone].stats.BusCar++; }
		 		if(accident.vehicule_3_cadmin == "PL<=7,5") { zones[liste_accidents[i].zone].stats.PoidsLourd++; }
		 		if(accident.vehicule_3_cadmin == "PL>7,5") { zones[liste_accidents[i].zone].stats.PoidsLourd++; }
		 		if(accident.vehicule_3_cadmin == "PLRem") { zones[liste_accidents[i].zone].stats.PoidsLourd++; }
		 		if(accident.vehicule_3_cadmin == "TRSem") { zones[liste_accidents[i].zone].stats.PoidsLourd++; }
		 		if(accident.vehicule_3_cadmin == "Tram") { zones[liste_accidents[i].zone].stats.Tram++; }
		 	}
		 }
         
		///*******************************************///
		///*******************************************///
		///*******************************************///
		
		
		d3.json("data/accidentologie-paris.geojson", function(data) {
			// create a first guess for the projection
			var center = d3.geoCentroid(data);
			var scale  = 15000;
			var offset = [mapbreakwidth/2, bigmapheight/2];
			var projection = d3.geoMercator().scale(scale).center(center).translate(offset);
	
			// create the path
			var path = d3.geoPath().projection(projection);
	
			// using the path determine the bounds of the current map and use 
			// these to determine better values for the scale and translation
			var bounds  = path.bounds(data);
			var hscale  = scale*mapbreakwidth  / (bounds[1][0] - bounds[0][0]);
			var vscale  = scale*bigmapheight / (bounds[1][1] - bounds[0][1]);
			var scale   = (hscale < vscale) ? hscale : vscale;
			var offset  = [mapbreakwidth - (bounds[0][0] + bounds[1][0])/2,
							bigmapheight - (bounds[0][1] + bounds[1][1])/2];
	
			// new projection
			projection = d3.geoMercator().center(center).scale(scale).translate(offset);
			path = path.projection(projection);
			
			
			console.log(data.features);
		        
		    // Contient la liste des centres de chaque zone ainsi que leurs statistiques
		    // zones = [ {center: [0]->x, [1]->y; stats: { nbAcc, Indem, BL, BH } } ]
		    zones = [];
		    
		   // Contient la liste des accidents classe par zone
		   // liste_accidents = [ {zone: id; accident: detail} ]
		    liste_accidents = [];
		    
		    // Test 1 (filtrage par un intervalle de date)
		    //getZones(data.features, 0.01, [75020, 75013], ["2013"], ["04","10"], ["07","22"], ["09:00","12:35"], ["2012-12-23", "2013-01-02"]);
		    
		    // Test 2 (filtrage par annees - mois - jours en particulier)
		    //getZones(data.features, 0.01, [], ["2013","2012"], ["04"], ["07"], [], []);
		    
		    // Test 3 (sans filtrage)
		    getZones(data.features, 0.01, [], [], [], [], [], []);
		    
		    graph = {"zones": zones, "accidents": liste_accidents};
		   	console.log(graph);
		   	
			
		   	// TODO Tentative d'ajout des zones
			/*g.selectAll("circle")
			.data(graph.zones)
			.enter()
			.append("circle")
			.attr("cx", function (d) { return projection(d.center)[0]; })
			.attr("cy", function (d) { return projection(d.center)[1]; })
			.attr("r", 10)
			.attr("fill", "blue");*/
	   	});
    </script>
  </body>
</html>
