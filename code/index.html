<!DOCTYPE html>
<html>
  <head>
    <title>Accidentologie Paris</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/3.15/themes/css/cartodb.css" />
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
	<link rel="stylesheet" href="/resources/demos/style.css">
	<link rel="stylesheet" href="./css/style.css">
	<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	<script>
	$( function() {
		$( ".years" ).checkboxradio({
  			icon: false
		});
		$( ".months" ).checkboxradio({
  			icon: false
		});
		$( ".days" ).checkboxradio({
  			icon: false
		});
		$( ".arrondissements" ).checkboxradio({
  			icon: false
		});
	} );
	
	function show()
	{
		if(document.getElementById('intervalle').checked==true) {
			document.getElementById('date').style.visibility='visible';
			document.getElementById('date').style.display='block';
			document.getElementById('year').style.visibility='hidden';
			document.getElementById('year').style.display='none';
			document.getElementById('month').style.visibility='hidden';
			document.getElementById('month').style.display='none';
			document.getElementById('day').style.visibility='hidden';
			document.getElementById('day').style.display='none';
		} else {
			document.getElementById('date').style.visibility='hidden';
			document.getElementById('date').style.display='none';
			document.getElementById('year').style.visibility='visible';
			document.getElementById('year').style.display='block';
			document.getElementById('month').style.visibility='visible';
			document.getElementById('month').style.display='block';
			document.getElementById('day').style.visibility='visible';
			document.getElementById('day').style.display='block';
		}
	}
	</script>
  </head>
  <body>
  	<div style="height:750px;">
  		<div class="container">
			<h3 style="text-align:center;">Choix du filtrage des dates</h3>
  			<ul>
			<li>
		  		<input type="radio" id="intervalle" name="selector" checked="true" onclick="show()">
				<label for="intervalle">Par un intervalle de date</label>
				<div class="check"></div>
			</li>
			<li>
				<input type="radio" id="multiple" name="selector" onclick="show()">
				<label for="multiple">Choix multiple Années/Mois/Jours</label>
				<div class="check"><div class="inside"></div></div>
			</li>
			</ul>
		</div>
  	
		<div class="widget" id="year" style="float:left; width:20%; height:200px; visibility:hidden; display:none;">
			<h3 style="text-align:center;">Choix multiple par Années/Mois/Jours</h3>
			<fieldset style="margin:auto; width:70px; height:80px;">
				<legend>Années : </legend>
				<label for="checkbox-2012">2012</label>
				<input type="checkbox" id="checkbox-2012" class="years" value="2012">
				<label for="checkbox-2013">2013</label>
				<input type="checkbox" id="checkbox-2013" class="years" value="2013">
			</fieldset>
		</div>
		<div class="widget" id="month" style="float:left; width:50%; height:200px; padding-top:50px; visibility:hidden; display:none;">
			<fieldset style="margin:auto; width:390px; height:120px;">
				<legend>Mois : </legend>
				<label for="checkbox-Janvier">Janvier</label>
				<input type="checkbox" id="checkbox-Janvier" class="months" value="01">
				<label for="checkbox-Fevrier">Février</label>
				<input type="checkbox" id="checkbox-Fevrier" class="months" value="02">
				<label for="checkbox-Mars">Mars</label>
				<input type="checkbox" id="checkbox-Mars" class="months" value="03">
				<label for="checkbox-Avril">Avril</label>
				<input type="checkbox" id="checkbox-Avril" class="months" value="04">
				<label for="checkbox-Mai">Mai</label>
				<input type="checkbox" id="checkbox-Mai" class="months" value="05">
				<label for="checkbox-Juin">Juin</label>
				<input type="checkbox" id="checkbox-Juin" class="months" value="06">
				<label for="checkbox-Juillet">Juillet</label>
				<input type="checkbox" id="checkbox-Juillet" class="months" value="07">
				<label for="checkbox-Aout">Août</label>
				<input type="checkbox" id="checkbox-Aout" class="months" value="08">
				<label for="checkbox-Septembre">Septembre</label>
				<input type="checkbox" id="checkbox-Septembre" class="months" value="09">
				<label for="checkbox-Octobre">Octobre</label>
				<input type="checkbox" id="checkbox-Octobre" class="months" value="10">
				<label for="checkbox-Novembre">Novembre</label>
				<input type="checkbox" id="checkbox-Novembre" class="months" value="11">
				<label for="checkbox-Decembre">Décembre</label>
				<input type="checkbox" id="checkbox-Decembre" class="months" value="12">
			</fieldset>
		</div>
		<div class="widget" id="day" style="float:left; margin-left:30%; width:70%; height:200px; visibility:hidden; display:none;">
			<fieldset style="margin:auto; width:450px; height:150px;">
				<legend>Jours : </legend>
				<label for="checkbox-01">01</label>
				<input type="checkbox" id="checkbox-01" class="days" value="01">
				<label for="checkbox-02">02</label>
				<input type="checkbox" id="checkbox-02" class="days" value="02">
				<label for="checkbox-03">03</label>
				<input type="checkbox" id="checkbox-03" class="days" value="03">
				<label for="checkbox-04">04</label>
				<input type="checkbox" id="checkbox-04" class="days" value="04">
				<label for="checkbox-05">05</label>
				<input type="checkbox" id="checkbox-05" class="days" value="05">
				<label for="checkbox-06">06</label>
				<input type="checkbox" id="checkbox-06" class="days" value="06">
				<label for="checkbox-07">07</label>
				<input type="checkbox" id="checkbox-07" class="days" value="07">
				<label for="checkbox-08">08</label>
				<input type="checkbox" id="checkbox-08" class="days" value="08">
				<label for="checkbox-09">09</label>
				<input type="checkbox" id="checkbox-09" class="days" value="09">
				<label for="checkbox-10">10</label>
				<input type="checkbox" id="checkbox-10" class="days" value="10">
				<label for="checkbox-11">11</label>
				<input type="checkbox" id="checkbox-11" class="days" value="11">
				<label for="checkbox-12">12</label>
				<input type="checkbox" id="checkbox-12" class="days" value="12">
				<label for="checkbox-13">13</label>
				<input type="checkbox" id="checkbox-13" class="days" value="13">
				<label for="checkbox-14">14</label>
				<input type="checkbox" id="checkbox-14" class="days" value="14">
				<label for="checkbox-15">15</label>
				<input type="checkbox" id="checkbox-15" class="days" value="15">
				<label for="checkbox-16">16</label>
				<input type="checkbox" id="checkbox-16" class="days" value="16">
				<label for="checkbox-17">17</label>
				<input type="checkbox" id="checkbox-17" class="days" value="17">
				<label for="checkbox-18">18</label>
				<input type="checkbox" id="checkbox-18" class="days" value="18">
				<label for="checkbox-19">19</label>
				<input type="checkbox" id="checkbox-19" class="days" value="19">
				<label for="checkbox-20">20</label>
				<input type="checkbox" id="checkbox-20" class="days" value="20">
				<label for="checkbox-21">21</label>
				<input type="checkbox" id="checkbox-21" class="days" value="21">
				<label for="checkbox-22">22</label>
				<input type="checkbox" id="checkbox-22" class="days" value="22">
				<label for="checkbox-23">23</label>
				<input type="checkbox" id="checkbox-23" class="days" value="23">
				<label for="checkbox-24">24</label>
				<input type="checkbox" id="checkbox-24" class="days" value="24">
				<label for="checkbox-25">25</label>
				<input type="checkbox" id="checkbox-25" class="days" value="25">
				<label for="checkbox-26">26</label>
				<input type="checkbox" id="checkbox-26" class="days" value="26">
				<label for="checkbox-27">27</label>
				<input type="checkbox" id="checkbox-27" class="days" value="27">
				<label for="checkbox-28">28</label>
				<input type="checkbox" id="checkbox-28" class="days" value="28">
				<label for="checkbox-29">29</label>
				<input type="checkbox" id="checkbox-29" class="days" value="29">
				<label for="checkbox-30">30</label>
				<input type="checkbox" id="checkbox-30" class="days" value="30">
				<label for="checkbox-31">31</label>
				<input type="checkbox" id="checkbox-31" class="days" value="31">
			</fieldset>
		</div>
		
		<div id="date" style="float:left; margin:auto; width:70%; height:250px;">
			<h3 style="text-align:center;">Choix par un intervalle de date</h3>
			<form style="text-align:center;">
			Date de début: <input type="date" id="beginDate" class="dates" min="2012-01-01" max="2013-12-31"><br>
			Date de fin: <input type="date" id="endDate" class="dates" min="2012-01-01" max="2013-12-31">
			</form>
		</div>
	
		<div class="widget" id="arrondissement" style="float:left; margin-top:20px; width:50%; height:250px;">
			<h3 style="text-align:center;">Choix multiple des arrondissements</h3>
			<fieldset style="margin:auto; width:400px; height:120px;">
				<legend>Arrondissements : </legend>
				<label for="checkbox-A01">01</label>
				<input type="checkbox" id="checkbox-A01" class="arrondissements" value="75001">
				<label for="checkbox-A02">02</label>
				<input type="checkbox" id="checkbox-A02" class="arrondissements" value="75002">
				<label for="checkbox-A03">03</label>
				<input type="checkbox" id="checkbox-A03" class="arrondissements" value="75003">
				<label for="checkbox-A04">04</label>
				<input type="checkbox" id="checkbox-A04" class="arrondissements" value="75004">
				<label for="checkbox-A05">05</label>
				<input type="checkbox" id="checkbox-A05" class="arrondissements" value="75005">
				<label for="checkbox-A06">06</label>
				<input type="checkbox" id="checkbox-A06" class="arrondissements" value="75006">
				<label for="checkbox-A07">07</label>
				<input type="checkbox" id="checkbox-A07" class="arrondissements" value="75007">
				<label for="checkbox-A08">08</label>
				<input type="checkbox" id="checkbox-A08" class="arrondissements" value="75008">
				<label for="checkbox-A09">09</label>
				<input type="checkbox" id="checkbox-A09" class="arrondissements" value="75009">
				<label for="checkbox-A10">10</label>
				<input type="checkbox" id="checkbox-A10" class="arrondissements" value="75010">
				<label for="checkbox-A11">11</label>
				<input type="checkbox" id="checkbox-A11" class="arrondissements" value="75011">
				<label for="checkbox-A12">12</label>
				<input type="checkbox" id="checkbox-A12" class="arrondissements" value="75012">
				<label for="checkbox-A13">13</label>
				<input type="checkbox" id="checkbox-A13" class="arrondissements" value="75013">
				<label for="checkbox-A14">14</label>
				<input type="checkbox" id="checkbox-A14" class="arrondissements" value="75014">
				<label for="checkbox-A15">15</label>
				<input type="checkbox" id="checkbox-A15" class="arrondissements" value="75015">
				<label for="checkbox-A16">16</label>
				<input type="checkbox" id="checkbox-A16" class="arrondissements" value="75016">
				<label for="checkbox-A17">17</label>
				<input type="checkbox" id="checkbox-A17" class="arrondissements" value="75017">
				<label for="checkbox-A18">18</label>
				<input type="checkbox" id="checkbox-A18" class="arrondissements" value="75018">
				<label for="checkbox-A19">19</label>
				<input type="checkbox" id="checkbox-A19" class="arrondissements" value="75019">
				<label for="checkbox-A20">20</label>
				<input type="checkbox" id="checkbox-A20" class="arrondissements" value="75020">
			</fieldset>
		</div>
		
		<div id="heure" style="float:right; width:50%; height:150px; margin-top:20px;">
			<h3 style="text-align:center;">Choix d'un intervalle d'heure</h3>
			<form style="text-align:center;">
			Heure de début: <input type="time" id="beginHour" class="hours">
			<br />
			Heure de fin: <input type="time" id="endHour" class="hours">
			</form>
		</div>
	
		<div style="float:right; width:50%; text-align:center; margin-top:20px;">
			<input type="button" value="Visualiser" onclick="processForm()" style="border-radius:8px; padding:12px 28px; font-size:16px;"/>
		</div>
	</div>
	
	<div id="map" style="margin-bottom:50px; border: 3px solid black"></div>
	
	<script>
	function processForm() {
		// Variable ou l'on va stocker les parametres de l'utilisateur
		var parameters = [];
		
		if(document.getElementById('multiple').checked == true) {
			// Recuperation des Annees
			var inputs = document.getElementsByClassName('years');
			years = [];
			for(var i = 0; i < inputs.length; ++i) {
				if(inputs[i].checked) {
					years.push(inputs[i].value);
				}
			}
			parameters.push({ "years": years });
		
			// Recuperation des Mois
			var inputs = document.getElementsByClassName('months');
			months = [];
			for(var i = 0; i < inputs.length; ++i) {
				if(inputs[i].checked) {
					months.push(inputs[i].value);
				}
			}
			parameters.push({ "months": months });
		
			// Recuperation des Jours
			var inputs = document.getElementsByClassName('days');
			days = [];
			for(var i = 0; i < inputs.length; ++i) {
				if(inputs[i].checked) {
					days.push(inputs[i].value);
				}
			}
			parameters.push({ "days": days });
		} else {
			parameters.push({ "years": [] });
			parameters.push({ "months": [] });
			parameters.push({ "days": [] });
		}
		
		// Recuperation des Arrondissements
		var inputs = document.getElementsByClassName('arrondissements');
		arrondissements = [];
		for(var i = 0; i < inputs.length; ++i) {
			if(inputs[i].checked) {
				arrondissements.push(parseInt(inputs[i].value));
			}
		}
		parameters.push({ "arrondissements": arrondissements });
		
		if(document.getElementById('intervalle').checked == true) {
			// Recuperation de l'intervalle de dates
			var inputs = document.getElementsByClassName('dates');
			dates = [];
			for(var i = 0; i < inputs.length; ++i) {
				if(inputs[i].value != "") {
					dates.push(inputs[i].value);
				}
			}
			if(dates.length == 2) { 
				parameters.push({ "dates": dates }); 
			} else {
				parameters.push({ "dates": [] });
			}
		} else {
			parameters.push({ "dates": [] });
		}
		
		// Recuperation de l'intervalle d'heures
		var inputs = document.getElementsByClassName('hours');
		hours = [];
		for(var i = 0; i < inputs.length; ++i) {
			if(inputs[i].value != "") {
				hours.push(inputs[i].value);
			}
		}
		if(hours.length == 2) {
			parameters.push({ "hours": hours });
		} else { 
			parameters.push({ "hours": [] });
		}
		
		console.log(parameters);
		
		// Mise a jour de la visualisation
		visualisation(parameters);
	};
	</script>
	
	

   <!-- include cartodb.js library -->
    <script src="http://libs.cartocdn.com/cartodb.js/v3/3.15/cartodb.js"></script>
	<script src="https://d3js.org/d3.v4.min.js"></script>
    <script>
		
    //  function main() 
     		  
		var bigmapheight = 650;
	  	var smallmapheight = 300;
	  	var mapbreakwidth = 720;
	  	var highzoom = 11;
	  	var lowzoom = 7;
	  	var initzoom;
//		var vizjson = 'https://mediafin.cartodb.com/api/v2/viz/6a800846-5607-11e5-b2d0-0e4fddd5de28/viz.json';
		
		//Set initial mapheight, based on the calculated width of the map container
		if ($("#map").width() > mapbreakwidth) {
			initzoom = highzoom;
			$("#map").height(bigmapheight);
		}
		else {
			initzoom = lowzoom;
			$("#map").height(smallmapheight);
		};
		
        var map = new L.Map('map', {
          center: [48.85841, 2.3488],
          zoom: initzoom
        });
		  
        L.tileLayer('http://tile.stamen.com/toner/{z}/{x}/{y}.png', {
          attribution: 'Stamen'
        }).addTo(map);
		  
        cartodb.createLayer(map, vizjson)
            .addTo(map)
         .on('done', function(layer) {
           layer.setInteraction(true);
		  
          layer.on('error', function(err) {
            cartodb.log.log('error: ' + err);
          });	
        })
		.on('error', function() {
          cartodb.log.log("some error occurred");
        });
		  
		//Use Leaflets resize event to set new map height and zoom level
		map.on('resize', function(e) {
		  	if (e.newSize.x < mapbreakwidth) {
				map.setZoom(lowzoom);
				$("#map").css('height', smallmapheight);
			};
			  
			if (e.newSize.x > mapbreakwidth) {
				map.setZoom(highzoom);
				$("#map").css('height', bigmapheight);
				$("#map").css('height', bigmapheight);
			};
		  });
    
      	// you could use $(window).load(main);
    	//  window.onload = main;
    	
    
    
    	///*******************************************///
		///********** Partie accidentologie **********///
		///*******************************************///
        
        // Convertie un intervalle d'heure en un intervalle de minute
     	function getMinutesInterval(hoursInterval) {
			minutesInterval = [];
			minutesInterval[0] = (parseInt(hoursInterval[0].slice(0,2)) * 60) + parseInt(hoursInterval[0].slice(3,5));
			minutesInterval[1] = (parseInt(hoursInterval[1].slice(0,2)) * 60) + parseInt(hoursInterval[1].slice(3,5));
			return minutesInterval;
		}


		// Renvoie si oui ou non une heure est incluse dans un intervalle d'heure
		function checkHoursInterval(hour, interval) {
			h = (parseInt(hour.slice(0,2)) * 60) + (parseInt(hour.slice(3,5)));
			if(h >= interval[0] && h <= interval[1]) {
				return true;
			}
			return false;
		}
		
		
		// Convertie un intervalle de date en un intervalle d'heure
		function getDaysInterval(dateInterval) {
			daysInterval = [];
			daysInterval[0] = (parseInt(dateInterval[0].slice(0,4)) * 365.2425) + (parseInt(dateInterval[0].slice(5,7)) * 30.44) + parseInt(dateInterval[0].slice(8,10));
			daysInterval[1] = (parseInt(dateInterval[1].slice(0,4)) * 365.2425) + (parseInt(dateInterval[1].slice(5,7)) * 30.44) + parseInt(dateInterval[1].slice(8,10));
			return daysInterval;
		}


		// Renvoie si oui ou non une date est incluse dans un intervalle de date
		function checkDaysInterval(date, interval) {
			d = (parseInt(date.slice(0,4)) * 365.2425) + (parseInt(date.slice(5,7)) * 30.44) + parseInt(date.slice(8,10));
			if(d >= interval[0] && d <= interval[1]) {
				return true;
			}
			return false;
		}
		
        
		 // Affecte un accident a une zone
		 function affectZone(accident, rayon) {
		 	for(var i=0; i < zones.length; ++i) {
		 		center = zones[i].center;
		 		x = accident.properties.wgs[0];
		 		y = accident.properties.wgs[1];
			 	// check coordonnee en X et Y
			 	if(x <= center[0]+rayon && x >= center[0]-rayon && y <= center[1]+rayon && y >= center[1]-rayon) {
		 			liste_accidents.push({ "zone": i, "accident": accident });
		 			return 0;
			 	}
			}
		
			// Aucune zone ne convient, on en creer donc une nouvelle
			zones.push({ "center": accident.properties.wgs, "stats" : { "nbAcc": 0, "Indem": 0, "BL": 0, "BH": 0, "Fuite": 0, "Conducteur": 0, "Passage": 0, "Pieton": 0, "Velo": 0, "Scooter": 0, "Moto": 0, "Voiture": 0, "VehiculeUtilitaire": 0, "BusCar": 0, "PoidsLourd": 0, "Tram": 0  } });
			id = zones.length-1;
			liste_accidents.push({ "zone": id, "accident": accident });
		 }
		 
		 
		 // Recupere toutes les zones d'accident
		 function getZones(accidents, rayon, arrondissements, annees, mois, jours, hoursInterval, dateInterval) {
		 	// On convertit l'intervalle d'heure en minute
		 	minutesInterval = []
		 	if(hoursInterval.length != 0) {
		 		minutesInterval = getMinutesInterval(hoursInterval);
		 	}
		 	
		 	// On convertit l'intervalle de date en jours
		 	daysInterval = []
		 	if(dateInterval.length != 0) {
		 		daysInterval = getDaysInterval(dateInterval);
		 	}
		 	
		 	// Creation des zones d'accident
		 	for(var i = 0; i < accidents.length; ++i) {
		 		// Filtre par arrondissement
		 		if(arrondissements.length == 0 || arrondissements.indexOf(accidents[i].properties.cp) != -1) {
		 			// Filtre par un intervalle de date (priorite) ou annees - mois - jours en particulier
		 			if(daysInterval.length != 0) {
		 				// Filtre par un intervalle de date
		 				if(checkDaysInterval(accidents[i].properties.date, daysInterval)) {
			 				// Filtre par un intervalle d'heure
			 				if(minutesInterval.length == 0 || checkHoursInterval(accidents[i].properties.heure, minutesInterval)) {
			 					id = affectZone(accidents[i], rayon);
			 				}
		 				}
		 			} else {	// Filtre par annees - mois - jours en particulier
			 			// Filtre par annee
			 			if(annees.length == 0 || annees.indexOf(accidents[i].properties.date.slice(0,4)) != -1) {
			 				// Filtre par mois
			 				if(mois.length == 0 || mois.indexOf(accidents[i].properties.date.slice(5,7)) != -1) {
			 					// Filtre par jours
			 					if(jours.length == 0 || jours.indexOf(accidents[i].properties.date.slice(8,10)) != -1) {
			 						// Filtre par un intervalle d'heure
			 						if(minutesInterval.length == 0 || checkHoursInterval(accidents[i].properties.heure, minutesInterval)) {
		 								id = affectZone(accidents[i], rayon);
		 							}
			 					}
			 				}
		 				}
	 				}
	 			}
		 	}
		 	
		 	
		 	// Ajout des statistiques aux zones
		 	for(var i = 0; i < liste_accidents.length; ++i) {
		 		// Mise a jour du nombre d'accident par zone
		 		zones[liste_accidents[i].zone].stats.nbAcc++;
		 		
		 		// Mise a jour de la gravite des blessures lors des accidents d'une zone (Indem, BL, BH)
		 		accident = liste_accidents[i].accident.properties;
		 		if(accident.usager_1_grav == "Indem") { zones[liste_accidents[i].zone].stats.Indem++; }
		 		if(accident.usager_1_grav == "BL") { zones[liste_accidents[i].zone].stats.BL++; }
		 		if(accident.usager_1_grav == "BH") { zones[liste_accidents[i].zone].stats.BH++; }
		 		if(accident.usager_2_grav == "Indem") { zones[liste_accidents[i].zone].stats.Indem++; }
		 		if(accident.usager_2_grav == "BL") { zones[liste_accidents[i].zone].stats.BL++; }
		 		if(accident.usager_2_grav == "BH") { zones[liste_accidents[i].zone].stats.BH++; }
		 		if(accident.usager_3_grav == "Indem") { zones[liste_accidents[i].zone].stats.Indem++; }
		 		if(accident.usager_3_grav == "BL") { zones[liste_accidents[i].zone].stats.BL++; }
		 		if(accident.usager_3_grav == "BH") { zones[liste_accidents[i].zone].stats.BH++; }
		 		if(accident.usager_4_grav == "Indem") { zones[liste_accidents[i].zone].stats.Indem++; }
		 		if(accident.usager_4_grav == "BL") { zones[liste_accidents[i].zone].stats.BL++; }
		 		if(accident.usager_4_grav == "BH") { zones[liste_accidents[i].zone].stats.BH++; }
		 		
		 		// Nombre de vehicule en fuite
		 		if(accident.usager_1_lveh == "Z") { zones[liste_accidents[i].zone].stats.Fuite++; }
		 		if(accident.usager_2_lveh == "Z") { zones[liste_accidents[i].zone].stats.Fuite++; }
		 		if(accident.usager_3_lveh == "Z") { zones[liste_accidents[i].zone].stats.Fuite++; }
		 		
		 		// Type d'usage (Conducteur, Passage, Pieton)
		 		if(accident.usager_1_catu == "Cond") { zones[liste_accidents[i].zone].stats.Conducteur++; }
		 		if(accident.usager_1_catu == "Pass") { zones[liste_accidents[i].zone].stats.Passage++; }
		 		if(accident.usager_1_catu == "Piéton") { zones[liste_accidents[i].zone].stats.Pieton++; }
		 		if(accident.usager_2_catu == "Cond") { zones[liste_accidents[i].zone].stats.Conducteur++; }
		 		if(accident.usager_2_catu == "Pass") { zones[liste_accidents[i].zone].stats.Passage++; }
		 		if(accident.usager_2_catu == "Piéton") { zones[liste_accidents[i].zone].stats.Pieton++; }
		 		if(accident.usager_3_catu == "Cond") { zones[liste_accidents[i].zone].stats.Conducteur++; }	
		 		if(accident.usager_3_catu == "Pass") { zones[liste_accidents[i].zone].stats.Passage++; }
		 		if(accident.usager_3_catu == "Piéton") { zones[liste_accidents[i].zone].stats.Pieton++; }
		 		if(accident.usager_4_catu == "Cond") { zones[liste_accidents[i].zone].stats.Conducteur++; }	
		 		if(accident.usager_4_catu == "Pass") { zones[liste_accidents[i].zone].stats.Passage++; }
		 		if(accident.usager_4_catu == "Piéton") { zones[liste_accidents[i].zone].stats.Pieton++; } 		
		 		
		 		// Type de vehicule (Velo, Scooter, Moto, Voiture, VehiculeUtilitaire, BusCar, PoidsLourd, Tram)
		 		if(accident.vehicule_1_cadmin == "Bicy") { zones[liste_accidents[i].zone].stats.Velo++; }
		 		if(accident.vehicule_1_cadmin == "Cyclo") { zones[liste_accidents[i].zone].stats.Scooter++; }
		 		if(accident.vehicule_1_cadmin == "Scoo<=50") { zones[liste_accidents[i].zone].stats.Scooter++; }
		 		if(accident.vehicule_1_cadmin == "Scoo50-125") { zones[liste_accidents[i].zone].stats.Scooter++; }
		 		if(accident.vehicule_1_cadmin == "Scoo>125") { zones[liste_accidents[i].zone].stats.Scooter++; }
		 		if(accident.vehicule_1_cadmin == "Moto50-125") { zones[liste_accidents[i].zone].stats.Moto++; }
		 		if(accident.vehicule_1_cadmin == "Moto>125") { zones[liste_accidents[i].zone].stats.Moto++; }
		 		if(accident.vehicule_1_cadmin == "VL") { zones[liste_accidents[i].zone].stats.Voiture++; }
		 		if(accident.vehicule_1_cadmin == "Voi") { zones[liste_accidents[i].zone].stats.Voiture++; }
		 		if(accident.vehicule_1_cadmin == "VU") { zones[liste_accidents[i].zone].stats.VehiculeUtilitaire++; }
		 		if(accident.vehicule_1_cadmin == "BUS") { zones[liste_accidents[i].zone].stats.BusCar++; }
		 		if(accident.vehicule_1_cadmin == "Car") { zones[liste_accidents[i].zone].stats.BusCar++; }
		 		if(accident.vehicule_1_cadmin == "PL<=7,5") { zones[liste_accidents[i].zone].stats.PoidsLourd++; }
		 		if(accident.vehicule_1_cadmin == "PL>7,5") { zones[liste_accidents[i].zone].stats.PoidsLourd++; }
		 		if(accident.vehicule_1_cadmin == "PLRem") { zones[liste_accidents[i].zone].stats.PoidsLourd++; }
		 		if(accident.vehicule_1_cadmin == "TRSem") { zones[liste_accidents[i].zone].stats.PoidsLourd++; }
		 		if(accident.vehicule_1_cadmin == "Tram") { zones[liste_accidents[i].zone].stats.Tram++; }
		 		
		 		if(accident.vehicule_2_cadmin == "Bicy") { zones[liste_accidents[i].zone].stats.Velo++; }
		 		if(accident.vehicule_2_cadmin == "Cyclo") { zones[liste_accidents[i].zone].stats.Scooter++; }
		 		if(accident.vehicule_2_cadmin == "Scoo<=50") { zones[liste_accidents[i].zone].stats.Scooter++; }
		 		if(accident.vehicule_2_cadmin == "Scoo50-125") { zones[liste_accidents[i].zone].stats.Scooter++; }
		 		if(accident.vehicule_2_cadmin == "Scoo>125") { zones[liste_accidents[i].zone].stats.Scooter++; }
		 		if(accident.vehicule_2_cadmin == "Moto50-125") { zones[liste_accidents[i].zone].stats.Moto++; }
		 		if(accident.vehicule_2_cadmin == "Moto>125") { zones[liste_accidents[i].zone].stats.Moto++; }
		 		if(accident.vehicule_2_cadmin == "VL") { zones[liste_accidents[i].zone].stats.Voiture++; }
		 		if(accident.vehicule_2_cadmin == "Voi") { zones[liste_accidents[i].zone].stats.Voiture++; }
		 		if(accident.vehicule_2_cadmin == "VU") { zones[liste_accidents[i].zone].stats.VehiculeUtilitaire++; }
		 		if(accident.vehicule_2_cadmin == "BUS") { zones[liste_accidents[i].zone].stats.BusCar++; }
		 		if(accident.vehicule_2_cadmin == "Car") { zones[liste_accidents[i].zone].stats.BusCar++; }
		 		if(accident.vehicule_2_cadmin == "PL<=7,5") { zones[liste_accidents[i].zone].stats.PoidsLourd++; }
		 		if(accident.vehicule_2_cadmin == "PL>7,5") { zones[liste_accidents[i].zone].stats.PoidsLourd++; }
		 		if(accident.vehicule_2_cadmin == "PLRem") { zones[liste_accidents[i].zone].stats.PoidsLourd++; }
		 		if(accident.vehicule_2_cadmin == "TRSem") { zones[liste_accidents[i].zone].stats.PoidsLourd++; }
		 		if(accident.vehicule_2_cadmin == "Tram") { zones[liste_accidents[i].zone].stats.Tram++; }
		 		
		 		if(accident.vehicule_3_cadmin == "Bicy") { zones[liste_accidents[i].zone].stats.Velo++; }
		 		if(accident.vehicule_3_cadmin == "Cyclo") { zones[liste_accidents[i].zone].stats.Scooter++; }
		 		if(accident.vehicule_3_cadmin == "Scoo<=50") { zones[liste_accidents[i].zone].stats.Scooter++; }
		 		if(accident.vehicule_3_cadmin == "Scoo50-125") { zones[liste_accidents[i].zone].stats.Scooter++; }
		 		if(accident.vehicule_3_cadmin == "Scoo>125") { zones[liste_accidents[i].zone].stats.Scooter++; }
		 		if(accident.vehicule_3_cadmin == "Moto50-125") { zones[liste_accidents[i].zone].stats.Moto++; }
		 		if(accident.vehicule_3_cadmin == "Moto>125") { zones[liste_accidents[i].zone].stats.Moto++; }
		 		if(accident.vehicule_3_cadmin == "VL") { zones[liste_accidents[i].zone].stats.Voiture++; }
		 		if(accident.vehicule_3_cadmin == "Voi") { zones[liste_accidents[i].zone].stats.Voiture++; }
		 		if(accident.vehicule_3_cadmin == "VU") { zones[liste_accidents[i].zone].stats.VehiculeUtilitaire++; }
		 		if(accident.vehicule_3_cadmin == "BUS") { zones[liste_accidents[i].zone].stats.BusCar++; }
		 		if(accident.vehicule_3_cadmin == "Car") { zones[liste_accidents[i].zone].stats.BusCar++; }
		 		if(accident.vehicule_3_cadmin == "PL<=7,5") { zones[liste_accidents[i].zone].stats.PoidsLourd++; }
		 		if(accident.vehicule_3_cadmin == "PL>7,5") { zones[liste_accidents[i].zone].stats.PoidsLourd++; }
		 		if(accident.vehicule_3_cadmin == "PLRem") { zones[liste_accidents[i].zone].stats.PoidsLourd++; }
		 		if(accident.vehicule_3_cadmin == "TRSem") { zones[liste_accidents[i].zone].stats.PoidsLourd++; }
		 		if(accident.vehicule_3_cadmin == "Tram") { zones[liste_accidents[i].zone].stats.Tram++; }
		 	}
		 }
         
		
		
		///*******************************************///
		///********** Partie Visualisation ***********///
		///*******************************************///
		
		function visualisation(parameters) {
			d3.json("data/accidentologie-paris.geojson", function(data) {
				// create a first guess for the projection
				var center = d3.geoCentroid(data);
				var scale  = 15000;
				var offset = [mapbreakwidth/2, bigmapheight/2];
				var projection = d3.geoMercator().scale(scale).center(center).translate(offset);
	
				// create the path
				var path = d3.geoPath().projection(projection);
	
				// using the path determine the bounds of the current map and use 
				// these to determine better values for the scale and translation
				var bounds  = path.bounds(data);
				var hscale  = scale*mapbreakwidth  / (bounds[1][0] - bounds[0][0]);
				var vscale  = scale*bigmapheight / (bounds[1][1] - bounds[0][1]);
				var scale   = (hscale < vscale) ? hscale : vscale;
				var offset  = [mapbreakwidth - (bounds[0][0] + bounds[1][0])/2,
								bigmapheight - (bounds[0][1] + bounds[1][1])/2];
	
				// new projection
				projection = d3.geoMercator().center(center).scale(scale).translate(offset);
				path = path.projection(projection);
			
			
				console.log(data.features);
				    
				// Contient la liste des centres de chaque zone ainsi que leurs statistiques
				// zones = [ {center: [0]->x, [1]->y; stats: { nbAcc, Indem, BL, BH } } ]
				zones = [];
				
			   // Contient la liste des accidents classe par zone
			   // liste_accidents = [ {zone: id; accident: detail} ]
				liste_accidents = [];
				
				// Test 1 (filtrage par un intervalle de date)
				//getZones(data.features, 0.01, [75020, 75013], ["2013"], ["04","10"], ["07","22"], ["09:00","12:35"], ["2012-12-23", "2013-01-02"]);
				
				// Test 2 (filtrage par annees - mois - jours en particulier)
				//getZones(data.features, 0.01, [], ["2013","2012"], ["04"], ["07"], [], []);
				
				// Test 3 (sans filtrage)
				//getZones(data.features, 0.01, [], [], [], [], [], []);
				
				// Recuperation des zones selon parameters
				getZones(data.features, 0.01, parameters[3].arrondissements, parameters[0].years, parameters[1].months, parameters[2].days, parameters[5].hours, parameters[4].dates);
				
				graph = {"zones": zones, "accidents": liste_accidents};
			   	console.log(graph);
			   	
			
			   	// TODO Tentative d'ajout des zones
				/*g.selectAll("circle")
				.data(graph.zones)
				.enter()
				.append("circle")
				.attr("cx", function (d) { return projection(d.center)[0]; })
				.attr("cy", function (d) { return projection(d.center)[1]; })
				.attr("r", 10)
				.attr("fill", "blue");*/
		   	});
	   	}
    </script>
  </body>
</html>
